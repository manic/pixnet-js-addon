<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh_TW">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>PIXNET Addons</title>
        <link rel="stylesheet" type="text/css" href="./www.css" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script> 
        <script src="../libs/js/jquery.query.min.js" type="text/javascript"></script> 
        <script src="../libs/js/json2.min.js" type="text/javascript"></script> 

        <script type="text/javascript">
            <!--
            (function($) {
                function get_data()
                {
                    var matches = $( "#url" ).val().match( /v=([\w\-]+)/ );
                    if (!matches) return '';
                    var type = $('input[name="share-embed-size"]:checked').val();
                    var w = 560;
                    var h = 315;
                    var custom_w = parseInt($('input[name="share-embed-size-width"]').val());
                    var custom_h = parseInt($('input[name="share-embed-size-height"]').val());
                    if ('medium' == type) {
                        w = 640;
                        h = 360;
                    } else if ('large' == type) {
                        w = 835;
                        h = 480;
                    } else if ('hd720' == type) {
                        w = 1280;
                        h = 720;
                    } else if ('custom' == type) {
                        if (!custom_w || !custom_h) return '';
                        if (custom_w < 560 || custom_h < 315) return '';
                        w = custom_w;
                        h = custom_h;
                    }
                    var data = $('#template').html().replace(/\${Height}/, h).replace(/\${Width}/, w).replace(/\${YoutubeId}/, matches[1]);
                    return data;
                }

                function changeSize(type)
                {
                    var w = 560;
                    var h = 315;
                    if ('medium' == type) {
                        w = 640;
                        h = 360;
                    } else if ('large' == type) {
                        w = 835;
                        h = 480;
                    } else if ('hd720' == type) {
                        w = 1280;
                        h = 720;
                    } else if ('custom' == type) {
                    } else {
                        type = 'default';
                    }
                    $('li.share-embed-size').removeClass('selected');
                    $('li.' + type).addClass('selected');
                    preview();
                }

                function preview()
                {
                    var data = get_data();
                    if (data) {
                        $( "#preview" ).empty().html(data);
                    }
                    return false;
                }


                $(function() {
                    $('#button_preview').click(function(){
                        $( "#preview" ).empty().html(get_data());
                        return false;
                    });

                    $('#button_return').click(function(){
                        var return_url = $.query.get('return_url');
                        var ptoken = $.query.get('pToken');
                        var addon_id = $.query.get('addon_id');
                        var json_data = { reply: get_data() };
                        $('#form').attr('action', return_url);
                        $('#pToken').val(ptoken);
                        $('#addon_id').val(addon_id);
                        $('#json_data').val(JSON.stringify(json_data));
                        $( "#form" ).submit();
                    });
                    $('input[name="share-embed-size"]').click(function() {
                        var type = $(this).val();
                        changeSize(type);
                        return false;
                    });

                    $('input[name="share-embed-size-width"]').change(function() {
                        $('input[name="share-embed-size-height"]').val(parseInt($(this).val() * 9 / 16));
                        preview();
                    });
                    $('input[name="share-embed-size-height"]').change(function() {
                        $('input[name="share-embed-size-width"]').val(parseInt($(this).val() * 16 / 9));
                        preview();
                    });

                    //changeSize('default');
                });
            })(jQuery);
            //-->
        </script>
    </head>
    <body>
        <p>
        <div class="share-panel refresh">
        輸入 youtube 網址: <input type="text" name="url" id="url"><br>
        <input type="hidden" name="width" id="width" value="">
        <input type="hidden" name="height" id="height" value="">
        <ul class="share-embed-size-list">
            <li class="share-embed-size default wide">
            <label>
                <input type="radio" name="share-embed-size" value="default" class="share-embed-size-radio " data-width="560" data-height="315">
                <span class="share-embed-size-name">560 × 315</span>
                <span class="share-embed-size-box default"></span>
            </label>
            </li>
            <li class="share-embed-size medium wide">
            <label>
                <input type="radio" name="share-embed-size" value="medium" class="share-embed-size-radio " data-width="640" data-height="360">
                <span class="share-embed-size-name">640 × 360</span>
                <span class="share-embed-size-box medium"></span>
            </label>
            </li>
            <li class="share-embed-size large wide">
            <label>
                <input type="radio" name="share-embed-size" value="large" class="share-embed-size-radio " data-width="853" data-height="480">
                <span class="share-embed-size-name">853 × 480</span>
                <span class="share-embed-size-box large"></span>
            </label>
            </li>
            <li class="share-embed-size hd720 wide">
            <label>
                <input type="radio" name="share-embed-size" value="hd720" class="share-embed-size-radio  hd" data-width="1280" data-height="720">
                <span class="share-embed-size-name">1280 × 720</span>
                <span class="share-embed-size-box hd720"></span>
            </label>
            </li>

            <li class="share-embed-size custom">
            <label>
                <input type="radio" name="share-embed-size" value="custom" class="share-embed-size-radio share-embed-size-radio-custom" data-width="-1" data-height="-1">
                <span class="share-embed-size-name">
                    自訂
                </span>
                <ul class="share-embed-customize">
                    <li>
                    <label>
                        寬度：
                        <input type="text" class="yt-uix-form-input-text share-embed-size-custom-width" maxlength="4" name="share-embed-size-width"> px
                    </label>
                    </li>
                    <li>
                    <label>
                        高度：
                        <input type="text" class="yt-uix-form-input-text share-embed-size-custom-height" maxlength="4" name="share-embed-size-height"> px
                    </label>
                    </li>
                </ul>
            </label>
            </li>
        </ul>
        </div>
        <button id="button_preview" class="yt-uix-button">預覽</button>
        <button id="button_return" class="yt-uix-button">送出</button>
        </p>
        <div id="preview" style="height: 720px;">
        </div>

        <script type="text/html" id="template"><iframe title="YouTube video player" width="${Width}" height="${Height}" src="http://www.youtube.com/embed/${YoutubeId}" frameborder="0" allowfullscreen></iframe></script>

        <form action="" method="post" id="form">
            <input type="hidden" name="addon_id" id="addon_id" value="">
            <input type="hidden" name="pToken" id="pToken" value="">
            <input type="hidden" name="json_data" id="json_data" value="">
        </form>

    </body>
</html>
